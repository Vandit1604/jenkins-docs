<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: Jenkins</title>
    <link rel="canonical" href="https://docs.jenkins.com/security/advisory/2021-11-04.html">
    <meta name="generator" content="Antora 3.1.5">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script>var uiRootPath = '../../_'</script>
<link rel="icon" href="../../_/jenkins.svg" type="image/x-icon">
  </head>
  <body class="article">
<script type="module" src="https://unpkg.com/@jenkinsci/jenkins-io-components?module"></script>
<jio-navbar style="  position: fixed;
  top: 0;
  width: 100vw;
  z-index: 100;"></jio-navbar>
  <div class="body">
<div class="nav-container" data-component="security" data-version="">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Jenkins Security Advisories</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">For Adminstrators</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../for-administrators.html">"Overview for Jenkins Administrators"</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../scheduling.html">How We Schedule Security Advisories</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../plugins.html">Managing Plugins</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../fixing.html">How We Fix Security Issues</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">For Reporters</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../reporting.html">"Reporting Security Vulnerabilities"</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../cna.html">Jenkins CVE Numbers Authority</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">For Maintainers</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../for-maintainers.html">"Overview for Plugin Maintainers"</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../plugins.html">Managing Plugins</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Jenkins Security Team</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../team.html">About the Jenkins Security Team</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../improvements.html">Improvements by the Security Team</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Jenkins Security Advisories</span>
    <span class="version">latest</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../about/index.html">About Jenkins</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../about/index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../images/index.html">All of Jenkins Images</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../images/index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../books/index.html">Jenkins Books</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../books/index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../community/index.html">Jenkins Community</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../community/index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../dev-docs/index.html">Jenkins Developer Documentation</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../dev-docs/index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../download/latest/index.html">Jenkins Download and Deployment</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../download/latest/index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../events/index.html">Jenkins Events</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../events/index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../Jenkins%20Project/index.html">Jenkins Project</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../Jenkins%20Project/index.html">default</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../projects/index.html">Jenkins Projects</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../projects/index.html">default</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../index.html">Jenkins Security Advisories</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../solutions/2.426.1/index.html">Jenkins Solutions Page</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../solutions/2.426.1/index.html">2.426.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../sigs/index.html">Jenkins Special Interest Groups</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../sigs/index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../tutorial/2.426.1/index.html">Jenkins Tutorials</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../tutorial/2.426.1/index.html">2.426.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../user-docs/2.426.1/index.html">Jenkins User Documentation</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../user-docs/2.426.1/index.html">2.426.1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../user-docs/2.426.1/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
</nav>
  <div class="edit-this-page"><a href="https://github.com/Vandit1604/jenkins-docs/edit/main/docs/security/modules/ROOT/pages/advisory/2021-11-04.adoc"><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M441 58.9L453.1 71c9.4 9.4 9.4 24.6 0 33.9L424 134.1 377.9 88 407 58.9c9.4-9.4 24.6-9.4 33.9 0zM209.8 256.2L344 121.9 390.1 168 255.8 302.2c-2.9 2.9-6.5 5-10.4 6.1l-58.5 16.7 16.7-58.5c1.1-3.9 3.2-7.5 6.1-10.4zM373.1 25L175.8 222.2c-8.7 8.7-15 19.4-18.3 31.1l-28.6 100c-2.4 8.4-.1 17.4 6.1 23.6s15.2 8.5 23.6 6.1l100-28.6c11.8-3.4 22.5-9.7 31.1-18.3L487 138.9c28.1-28.1 28.1-73.7 0-101.8L474.9 25C446.8-3.1 401.2-3.1 373.1 25zM88 64C39.4 64 0 103.4 0 152V424c0 48.6 39.4 88 88 88H360c48.6 0 88-39.4 88-88V312c0-13.3-10.7-24-24-24s-24 10.7-24 24V424c0 22.1-17.9 40-40 40H88c-22.1 0-40-17.9-40-40V152c0-22.1 17.9-40 40-40H200c13.3 0 24-10.7 24-24s-10.7-24-24-24H88z"/></svg>  Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<div class="admonitionblock note">
    <table>
        <tbody>
            <tr>
                <td class="icon"> <i class="fa icon-note" title="Note"></i> </td>
                <td class="content">
                    <div class="paragraph">
                        <p>This site is the new docs site currently being tested. For the actual docs in use please go to <a href="https://www.jenkins.io/doc/">https://www.jenkins.io/doc</a>.</p>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<hr>
<div class="paragraph">
<p>layout: advisory
title: Jenkins Security Advisory 2021-11-04
kind: core and plugin
core:
  lts:
    previous: 2.303.2
    fixed: 2.303.3
  weekly:
    previous: '2.318'
    fixed: '2.319'
issues:
- id: SECURITY-2455
  reporter: Daniel Beck, CloudBees, Inc.
  title: Multiple vulnerabilities allow bypassing path filtering of agent-to-controller
    access control
  cve: CVE-2021-21685, CVE-2021-21686, CVE-2021-21687, CVE-2021-21688, CVE-2021-21689,
    CVE-2021-21690, CVE-2021-21691, CVE-2021-21692, CVE-2021-21693, CVE-2021-21694,
    CVE-2021-21695
  cvss:
    severity: Critical
    vector: CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:C/C:H/I:H/A:H
  description: |-
    The agent-to-controller security subsystem limits which files on the Jenkins controller can be accessed by agent processes.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Multiple vulnerabilities in the file path filtering implementation of Jenkins 2.318 and earlier, LTS 2.303.2 and earlier allow agent processes to read and write arbitrary files on the Jenkins controller file system, and obtain some information about Jenkins controller file systems.</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>SECURITY-2427 / CVE-2021-21685: <code>FilePath#mkdirs</code> does not check permission to create parent directories.</p>
</li>
<li>
<p>SECURITY-2444 / CVE-2021-21686: File path filters do not canonicalize paths, allowing operations to follow symbolic links to outside allowed directories.</p>
</li>
<li>
<p>SECURITY-2446 / CVE-2021-21687: <code>FilePath#untar</code> does not check permission to create symbolic links when unarchiving a symbolic link.</p>
</li>
<li>
<p>SECURITY-2484 / CVE-2021-21688: <code>FilePath#reading(FileVisitor)</code> does not reject any operations, allowing users to have unrestricted read access using certain operations (creating archives, <code>#copyRecursiveTo</code>).</p>
</li>
<li>
<p>SECURITY-2485 / CVE-2021-21689: <code>FilePath#unzip</code> and <code>FilePath#untar</code> were not subject to any access control.</p>
</li>
<li>
<p>SECURITY-2486 / CVE-2021-21690: Agent processes are able to completely bypass file path filtering by wrapping the file operation in an agent file path.</p>
</li>
<li>
<p>SECURITY-2531 / CVE-2021-21691: Creating symbolic links is possible without the <code>symlink</code> permission.</p>
</li>
<li>
<p>SECURITY-2538 / CVE-2021-21692: The operations <code>FilePath#renameTo</code> and <code>FilePath#moveAllChildrenTo</code> only check read permission on the source path.</p>
</li>
<li>
<p>SECURITY-2539 / CVE-2021-21693: When creating temporary files, permission to create files is only checked after they&#8217;ve been created.</p>
</li>
<li>
<p>SECURITY-2541 / CVE-2021-21694: <code>FilePath#toURI</code>, <code>FilePath#hasSymlink</code>, <code>FilePath#absolutize</code>, <code>FilePath#isDescendant</code>, and <code>FilePath#get*DiskSpace</code> do not check any permissions.</p>
</li>
<li>
<p>SECURITY-2542 / CVE-2021-21695: <code>FilePath#listFiles</code> lists files outside directories with agent read access when following symbolic links.</p>
<div class="literalblock">
<div class="content">
<pre>We expect that most of these vulnerabilities have been present since link:/security/advisory/2014-10-30/[SECURITY-144 was addressed in the 2014-10-30 security advisory].</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Jenkins 2.319, LTS 2.303.3 addresses these security vulnerabilities.</pre>
</div>
</div>
</li>
<li>
<p>SECURITY-2427 / CVE-2021-21685: <code>FilePath#mkdirs</code> checks permission to create parent directories.</p>
</li>
<li>
<p>SECURITY-2444 / CVE-2021-21686: File path filters canonicalize paths, preventing operations from following symbolic links to outside allowed directories.</p>
</li>
<li>
<p>SECURITY-2446 / CVE-2021-21687: <code>FilePath#untar</code> checks permission to create symbolic links when unarchiving a symbolic link.</p>
</li>
<li>
<p>SECURITY-2484 / CVE-2021-21688: <code>FilePath#reading(FileVisitor)</code> correctly rejects operations if they operate on files outside allowed directories.</p>
</li>
<li>
<p>SECURITY-2485 / CVE-2021-21689: <code>FilePath#unzip</code> and <code>FilePath#untar</code> are now subject to access control.</p>
</li>
<li>
<p>SECURITY-2486 / CVE-2021-21690: Agent processes are no longer able to completely bypass file path filtering by wrapping the file operation in an agent file path.</p>
</li>
<li>
<p>SECURITY-2531 / CVE-2021-21691: Creating symbolic links now correctly checks the <code>symlink</code> permission.</p>
</li>
<li>
<p>SECURITY-2538 / CVE-2021-21692: The operations <code>FilePath#renameTo</code> and <code>FilePath#moveAllChildrenTo</code> check both <code>read</code> and <code>delete</code> permissions on the source path.</p>
</li>
<li>
<p>SECURITY-2539 / CVE-2021-21693: When creating temporary files, permission to create files is checked before they are created based on an artificial path.</p>
</li>
<li>
<p>SECURITY-2541 / CVE-2021-21694: <code>FilePath#toURI</code>, <code>FilePath#hasSymlink</code>, <code>FilePath#absolutize</code>, <code>FilePath#isDescendant</code> check <code>stat</code> permission. <code>FilePath#get*DiskSpace</code> methods are no longer allowed to be executed by an agent.</p>
</li>
<li>
<p>SECURITY-2542 / CVE-2021-21695: <code>FilePath#listFiles</code> checks <code>stat</code> permission on files it returns, preventing listing files outside allowed directories.</p>
<div class="literalblock">
<div class="content">
<pre>IMPORTANT: As some common operations are now newly subject to access control, it is expected that plugins sending commands from agents to the controller may start failing.
Additionally, the newly introduced path canonicalization means that instances using a custom builds directory (xref:user-docs:managing:system-properties.adoc#jenkins-model-jenkins-buildsdir[Java system property `jenkins.model.Jenkins.buildsDir`]) or partitioning `JENKINS_HOME` using symbolic links may fail access control checks.
See xref:dev-docs:security:controller-isolation/agent-to-controller.adoc#file-access-rules[the documentation] for how to customize the configuration in case of problems.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    NOTE: If you are unable to immediately upgrade to Jenkins 2.319, LTS 2.303.3, you can install the link:/redirect/remoting-security-workaround/[Remoting Security Workaround Plugin].
    It will prevent all agent-to-controller file access using `FilePath` APIs.
    Because it is more restrictive than Jenkins 2.319, LTS 2.303.3, more plugins are incompatible with it.
    Make sure to read the plugin documentation before installing it.
- id: SECURITY-2423
  reporter: Daniel Beck, CloudBees, Inc.
  title: 'Agent-to-controller access control allowed writing to sensitive directory
    used by Pipeline: Shared Groovy Libraries Plugin'
  cve: CVE-2021-21696
  cvss:
    severity: High
    vector: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
  description: |-
    Jenkins 2.318 and earlier, LTS 2.303.2 and earlier does not limit agent read/write access to the `libs/` directory inside build directories when using the `FilePath` APIs.
    This directory is used by the Pipeline: Shared Groovy Libraries Plugin to store copies of shared libraries.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>This allows attackers in control of agent processes to replace the code of a trusted library with a modified variant, resulting in unsandboxed code execution in the Jenkins controller process.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Jenkins 2.319, LTS 2.303.3 prohibits agent read/write access to the `libs/` directory inside build directories.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>NOTE: If you are unable to immediately upgrade to Jenkins 2.319, LTS 2.303.3, you can install the link:/redirect/remoting-security-workaround/[Remoting Security Workaround Plugin].
It will prevent all agent-to-controller file access using `FilePath` APIs.
Because it is more restrictive than Jenkins 2.319, LTS 2.303.3, more plugins are incompatible with it.
Make sure to read the plugin documentation before installing it.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    IMPORTANT: It is not easily possible to xref:dev-docs:security:controller-isolation/agent-to-controller.adoc#file-access-rules[customize the file access rules] to prohibit access to the `libs/` directory specifically, as built-in rules (granting access to `&lt;BUILDDIR&gt;` contents) would take precedence over a custom rule prohibiting access.
- id: SECURITY-2428
  reporter: Daniel Beck, CloudBees, Inc.
  title: Agent-to-controller access control allows reading/writing most content of
    build directories
  cve: CVE-2021-21697
  cvss:
    severity: High
    vector: CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:C/C:H/I:H/A:L
  description: |-
    Agents are allowed some limited access to files on the Jenkins controller file system.
    The directories agents are allowed to access in Jenkins 2.318 and earlier, LTS 2.303.2 and earlier include the directories storing build-related information, intended to allow agents to store build-related metadata during build execution.
    As a consequence, this allows any agent to read and write the contents of any build directory stored in Jenkins with very few restrictions (`build.xml` and some Pipeline-related metadata).</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Jenkins 2.319, LTS 2.303.3 prevents agents from accessing contents of build directories unless it's for builds currently running on the agent attempting to access the directory.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>NOTE: Update https://plugins.jenkins.io/workflow-durable-task-step/[Pipeline: Nodes and Processes] to version 2.40 or newer for Jenkins to associate Pipeline `node` blocks with the agent they're running on for this fix.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    NOTE: If you are unable to immediately upgrade to Jenkins 2.319, LTS 2.303.3, you can install the link:/redirect/remoting-security-workaround/[Remoting Security Workaround Plugin].
    It will prevent all agent-to-controller file access using `FilePath` APIs.
    Because it is more restrictive than Jenkins 2.319, LTS 2.303.3, more plugins are incompatible with it.
    Make sure to read the plugin documentation before installing it.
- id: SECURITY-2506
  reporter: Daniel Beck, CloudBees, Inc.
  title: Path traversal vulnerability in PLUGIN_NAME allows reading arbitrary files
  cve: CVE-2021-21698
  cvss:
    severity: Medium
    vector: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:N
  description: |-
    PLUGIN_NAME 2.15.0 and earlier does not restrict the name of a file when looking up a subversion key file on the controller from an agent.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>This allows attackers able to control agent processes to read arbitrary files on the Jenkins controller file system.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>  PLUGIN_NAME 2.15.1 checks for the presence of and prohibits directory separator characters as part of the file name, restricting it to the intended directory.
plugins:
- name: subversion
  previous: 2.15.0
  fixed: 2.15.1</pre>
</div>
</div>
</li>
</ul>
</div>
</article>
  </div>
</main>
</div>
<jio-footer></jio-footer>
<script id="site-script" src="../../_/js/site.js" data-ui-root-path="../../_"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
