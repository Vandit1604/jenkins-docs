<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Jenkins and PHP :: Jenkins Docs</title>
    <link rel="canonical" href="https://docs.jenkins.com/solutions/2.426.x/php.html">
    <link rel="prev" href="android.html">
    <link rel="next" href="docker.html">
    <meta name="generator" content="Antora 3.1.7">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script>var uiRootPath = '../../_'</script>
<link rel="icon" href="../../favicon.png" type="image/x-icon">
  </head>
  <body class="article">
<script type="module" src="https://unpkg.com/@jenkinsci/jenkins-io-components?module"></script>
<jio-navbar style="  position: fixed;
  top: 0;
  width: 100vw;
  z-index: 100;"></jio-navbar>
  <div class="body">
<div class="nav-container" data-component="solutions" data-version="2.426.x">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">Solutions Page</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="android.html">Jenkins and Android</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="php.html">Jenkins and PHP</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="docker.html">Jenkins and Docker</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="python.html">Jenkins and Python</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ruby.html">Jenkins and Ruby</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="pipeline.html">Pipeline as Code with Jenkins</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="github.html">Jenkins with GitHub</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="embedded.html">Jenkins in the Embedded World</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="bitbucketserver.html">Bitbucket Server</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="c.html">Jenkins and C/C++</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../user-docs/2.426.x/platform-information/support-policy-java.html">Java Support Policy</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Solutions Page</span>
    <span class="version">2.426.x</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../about/index.html">About Jenkins</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../about/index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../images/index.html">Artwork</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../images/index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../books/index.html">Books</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../books/index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../community/index.html">Community</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../community/index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../dev-docs/index.html">Developer Documentation</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../dev-docs/index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../download/latest/index.html">Download and Deployment</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../download/latest/index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../events/index.html">Jenkins Events</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../events/index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../projects/index.html">Projects</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../projects/index.html">default</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../security/index.html">Security Advisories</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../security/index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="index.html">Solutions Page</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">2.426.x</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../sigs/index.html">Special Interest Groups (SIGs)</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../sigs/index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../project/index.html">The Jenkins Project</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../project/index.html">default</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../tutorials/2.426.x/index.html">Tutorials</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../tutorials/2.426.x/index.html">2.426.x</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../user-docs/2.426.x/index.html">User Documentation</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../user-docs/2.426.x/index.html">2.426.x</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../user-docs/2.426.x/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Solutions Page</a></li>
    <li><a href="php.html">Jenkins and PHP</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/Vandit1604/jenkins-docs/edit/main/docs/solutions/modules/ROOT/pages/php.adoc"><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M441 58.9L453.1 71c9.4 9.4 9.4 24.6 0 33.9L424 134.1 377.9 88 407 58.9c9.4-9.4 24.6-9.4 33.9 0zM209.8 256.2L344 121.9 390.1 168 255.8 302.2c-2.9 2.9-6.5 5-10.4 6.1l-58.5 16.7 16.7-58.5c1.1-3.9 3.2-7.5 6.1-10.4zM373.1 25L175.8 222.2c-8.7 8.7-15 19.4-18.3 31.1l-28.6 100c-2.4 8.4-.1 17.4 6.1 23.6s15.2 8.5 23.6 6.1l100-28.6c11.8-3.4 22.5-9.7 31.1-18.3L487 138.9c28.1-28.1 28.1-73.7 0-101.8L474.9 25C446.8-3.1 401.2-3.1 373.1 25zM88 64C39.4 64 0 103.4 0 152V424c0 48.6 39.4 88 88 88H360c48.6 0 88-39.4 88-88V312c0-13.3-10.7-24-24-24s-24 10.7-24 24V424c0 22.1-17.9 40-40 40H88c-22.1 0-40-17.9-40-40V152c0-22.1 17.9-40 40-40H200c13.3 0 24-10.7 24-24s-10.7-24-24-24H88z"/></svg>  Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Jenkins and PHP</h1>
<div class="admonitionblock note">
    <table>
        <tbody>
            <tr>
                <td class="icon"> <i class="fa icon-note" title="Note"></i> </td>
                <td class="content">
                    <div class="paragraph">
                        <p>This site is the new docs site currently being tested. For the actual docs in use please go to <a href="https://www.jenkins.io/doc/">https://www.jenkins.io/doc</a>.</p>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Most web applications are changed and adapted quite frequently and quickly.
Their environment, for example the size and the behaviour of the user base, are
constantly changing. What was sufficient yesterday can be insufficient today.
Especially in a web environment it is important to monitor and continuously
improve the internal quality not only when developing, but also when
maintaining the software.</p>
</div>
<div class="paragraph">
<p>This guide provides a basic configuration for testing and reporting for PHP
projects with Jenkins.</p>
</div>
<div class="paragraph">
<p>In addition to running and reporting tests, you&#8217;ll get reports on test run
times, test coverage (including visualizations), and static analysis checks,
including trend graphs, and new and fixed issues compared to the master /
reference branch.</p>
</div>
<div class="paragraph">
<p>Use the <strong>pipeline step reference</strong> link on the plugin pages for full
documentation and options for Jenkinsfile.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_php_tools"><a class="anchor" href="#_configuring_php_tools"></a>Configuring PHP Tools</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This guide uses Jenkinsfile based pipelines and assumes you already have a
basic Jenkinsfile.</p>
</div>
<div class="paragraph">
<p>This guide assumes that you already have each of the tools mentioned
configured for use outside of Jenkins. Only the necessary configuration
options for working with Jenkins are mentioned.</p>
</div>
<div class="paragraph">
<p>This guide uses the <code>build/</code> directory for storing generated logs and reports.</p>
</div>
<div class="paragraph">
<p>It&#8217;s assumed that all tools configuration files are in the repository root and
PHP code is in the <code>src</code> subdirectory.</p>
</div>
<div class="sect2">
<h3 id="_phpunit_test_coverage_reports"><a class="anchor" href="#_phpunit_test_coverage_reports"></a>PHPUnit Test &amp; Coverage Reports</h3>
<div class="paragraph">
<p>The following configuration will set up 3 reports for PHPUnit tests:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Pass/fail monitoring via the <a href="https://plugins.jenkins.io/xunit">xUnit plugin</a></p>
</li>
<li>
<p>Coverage stats via the <a href="https://plugins.jenkins.io/code-coverage-api">Code Coverage API plugin</a> (using the cobertura adaptor)</p>
</li>
<li>
<p>HTML coverage report via the <a href="https://plugins.jenkins.io/htmlpublisher">HTML Publisher plugin</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the PHPUnit config file (<code>phpunit.xml</code> or <code>phpunit.xml.dist</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;phpunit&gt;
    &lt;coverage&gt;
        &lt;include&gt;
            &lt;directory suffix=".php"&gt;src&lt;/directory&gt;
        &lt;/include&gt;
        &lt;report&gt;
            &lt;html outputDirectory="build/coverage" /&gt;
            &lt;cobertura outputFile="build/logs/cobertura.xml"/&gt;
        &lt;/report&gt;
    &lt;/coverage&gt;
    &lt;logging&gt;
        &lt;junit outputFile="build/logs/junit.xml" /&gt;
    &lt;/logging&gt;
&lt;/phpunit&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the Jenkinsfile:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">stage('Unit Tests') {
    steps {
        sh 'vendor/bin/phpunit'
        xunit([
            thresholds: [
                failed ( failureThreshold: "0" ),
                skipped ( unstableThreshold: "0" )
            ],
            tools: [
                PHPUnit(pattern: 'build/logs/junit.xml', stopProcessingIfError: true, failIfNotNew: true)
            ]
        ])
        publishHTML([
            allowMissing: false,
            alwaysLinkToLastBuild: false,
            keepAll: false,
            reportDir: 'build/coverage',
            reportFiles: 'index.html',
            reportName: 'Coverage Report (HTML)',
            reportTitles: ''
        ])
        publishCoverage adapters: [coberturaAdapter('build/logs/cobertura.xml')]
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_phpstan_and_codesniffer_static_analysis_reports"><a class="anchor" href="#_phpstan_and_codesniffer_static_analysis_reports"></a>PHPStan and CodeSniffer Static Analysis Reports</h3>
<div class="paragraph">
<p>In this example, PHPCS is shown running with 2 different configurations (mainly
to show this can be done).</p>
</div>
<div class="paragraph">
<p>Reports are processed using the CheckStyle format report and the
<a href="https://plugins.jenkins.io/warnings-ng">Warnings Next Generation plugin</a></p>
</div>
<div class="paragraph">
<p>This is done because PHPCompatibility checks are run across the <code>vendor/</code>
directory to aid in monitoring potential problems for version updates.</p>
</div>
<div class="paragraph">
<p>This example setup shows running the static analysis tools in parallel, which
may result in faster build times.</p>
</div>
<div class="paragraph">
<p>In Jenkinsfile:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">stages {
    stage('Static Analysis') {
        parallel {
          stage('CodeSniffer') {
              steps {
                  sh 'vendor/bin/phpcs --standard=phpcs.xml .'
              }
          }
          stage('PHP Compatibility Checks') {
              steps {
                  sh 'vendor/bin/phpcs --standard=phpcs-compatibility.xml .'
              }
          }
          stage('PHPStan') {
              steps {
                  sh 'vendor/bin/phpstan analyse --error-format=checkstyle --no-progress -n . &gt; build/logs/phpstan.checkstyle.xml'
              }
          }
        }
    }
    post {
        always {
            recordIssues([
                sourceCodeEncoding: 'UTF-8',
                enabledForFailure: true,
                aggregatingResults: true,
                blameDisabled: true,
                referenceJobName: "repo-name/master",
                tools: [
                    phpCodeSniffer(id: 'phpcs', name: 'CodeSniffer', pattern: 'build/logs/phpcs.checkstyle.xml', reportEncoding: 'UTF-8'),
                    phpStan(id: 'phpstan', name: 'PHPStan', pattern: 'build/logs/phpstan.checkstyle.xml', reportEncoding: 'UTF-8'),
                    phpCodeSniffer(id: 'phpcompat', name: 'PHP Compatibility', pattern: 'build/logs/phpcs-compat.checkstyle.xml', reportEncoding: 'UTF-8')
                ]
            ])
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You&#8217;ll want to change the <code>repo-name</code> in the <code>referenceJobName</code> directive to
match your repository. This tells Jenkins which job to compare the results
against for branches and PR jobs.</p>
</div>
<div class="paragraph">
<p>Set the report location in CodeSniffers configuration file (<code>phpcs.xml</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;ruleset name="Default"&gt;
    &lt;arg name="report-checkstyle" value="build/logs/phpcs.checkstyle.xml" /&gt;
&lt;/ruleset&gt;</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_ignoring_tool_run_failures_tuning_failure_conditions"><a class="anchor" href="#_ignoring_tool_run_failures_tuning_failure_conditions"></a>Ignoring tool run failures / tuning failure conditions</h4>
<div class="paragraph">
<p>If you want the build to pass regardless of the results of tools (ie. ignore
the exit code), you can append <code>|| exit 0</code> to the end of the <code>sh</code> command.</p>
</div>
<div class="paragraph">
<p>Alternatively, for CodeSniffer you can add the following into the configuration
file (<code>phpcs.xml</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;ruleset name="default"&gt;
    &lt;config name="ignore_errors_on_exit" value="1" /&gt;
    &lt;config name="ignore_warnings_on_exit" value="1" /&gt;
&lt;/ruleset&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then fine-tune the failure conditions using the
<a href="/doc/pipeline/steps/warnings-ng/">Warnings-NG pipeline configuration</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_results_caching"><a class="anchor" href="#_results_caching"></a>Results Caching</h4>
<div class="paragraph">
<p>You can improve build times (for each run after the first) using caching
features available in both CodeSniffer and PHPStan.</p>
</div>
<div class="paragraph">
<p>In CodeSniffers configuration file (<code>phpcs.xml</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;ruleset name="default"&gt;
    &lt;arg name="cache" value="build/cache/codesniffer.phpcs" /&gt;
&lt;/ruleset&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you have multiple CodeSniffer configurations as in the example Jenkinsfile
above, be sure to set different cache paths.</p>
</div>
<div class="paragraph">
<p>In PHPStan&#8217;s configuration file (<code>phpstan.neon</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">parameters:
    tmpDir: build/cache/phpstan</code></pre>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">PHP plugins for Jenkins</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="https://plugins.jenkins.io/xunit">xUnit</a></dt>
<dd>
<p>processing PHPUnit&#8217;s JUnit XML logfile</p>
</dd>
<dt class="hdlist1"><a href="https://plugins.jenkins.io/warnings-ng">Warnings Next Generation plugin</a></dt>
<dd>
<p>collects PHP compiler warnings and issues from static analysis tools such as PHP_CodeSniffer, PHPMD and phpcpd</p>
</dd>
<dt class="hdlist1"><a href="https://plugins.jenkins.io/code-coverage-api">Code Coverage API</a></dt>
<dd>
<p>for processing PHPUnit&#8217;s code coverage data</p>
</dd>
<dt class="hdlist1"><a href="https://plugins.jenkins.io/htmlpublisher">HTML Publisher</a></dt>
<dd>
<p>for publishing documentation generated by phpDox, for instance</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="android.html">Jenkins and Android</a></span>
  <span class="next"><a href="docker.html">Jenkins and Docker</a></span>
</nav>
</article>
  </div>
</main>
</div>
<jio-footer></jio-footer>
<script id="site-script" src="../../_/js/site.js" data-ui-root-path="../../_"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
