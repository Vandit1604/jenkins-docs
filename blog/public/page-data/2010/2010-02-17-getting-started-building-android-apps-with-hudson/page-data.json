{"componentChunkName":"component---src-templates-article-js","path":"/2010/2010-02-17-getting-started-building-android-apps-with-hudson/","result":{"data":{"asciidoc":{"html":"<div id=\"preamble\">\n<div class=\"sectionbody\">\n<div class=\"ulist\">\n<ul>\n<li>\n<p>jobs</p>\n</li>\n<li>\n<p>tutorial\n:author: rtyler\n---\nIn this post I&#8217;ll show a very basic tips on how to compile an Android project using Hudson. Specifically how  I use Hudson to create release versions of my apps.</p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_debug_vs_release\">Debug vs Release</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>I&#8217;m assuming that you are using <a href=\"https://en.wikipedia.org/wiki/Eclipse%20%28software%29\">Eclipse</a> with the <a href=\"https://developer.android.com/guide/developing/tools/adt.html\">ADT plugin</a>. During development you can test your app on the emulator or a device and resources like R.java and aidl files are compiled for you automatically by the plugin. When it&#8217;s time to release your app, you&#8217;ll need to go through some steps:</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>You must sign your app using a certificate</p>\n</li>\n<li>\n<p>You must update your AndroidManifest.xml to remove the android:debuggable attribute</p>\n</li>\n<li>\n<p>Replace your Google Maps API debug key with the one belonging to your release certificate (if you are using a MapView)</p>\n</li>\n<li>\n<p>Generate an apk package for the release and test it on a device or emulator</p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>It would be nice to automate a few of these steps, and this is where Hudson comes in.</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_automated_builds_ant\">Automated builds: Ant</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>For automated builds the Android SDK uses <a href=\"https://en.wikipedia.org/wiki/Apache%20Ant\">Apache Ant</a>, which Hudson has great support for. To generate a template build.xml you can use the android tool from the SDK using the following command:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre>android create project -n template -t android-7 -p template -k dummy.pkg -a Dummy</pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>The target is specified as \"android-7\" meaning that we are building for Android 2.1. For apps that use MapView we would use \"Google Inc.:Google APIs:7\". It is a good idea to always <a href=\"https://d.android.com/guide/practices/screens_support.html#strategies\">target the latest SDK</a>. From this template project we&#8217;ll grab the <em>build.properties</em> and the <em>build.xml</em> and copy those to the Android project that we want to build. Edit <em>build.xml</em> and set the project name to your Android project name.</p>\n</div>\n<div class=\"paragraph\">\n<p>The <em>local.properties</em> file contains the path to the SDK root and shouldn&#8217;t be checked in to version control. For our use we&#8217;ll set the properties that are in that file on the Hudson job configuration page.</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_running_the_build_in_hudson\">Running the build in Hudson</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>This part is easy: create a new freestyle job and let it be build with ant. The targets that we want to execute are <code>clean release</code>. Release will compile, package and sign your apk. Now to get this working right, some custom properties should be set (use the Advanced button).</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre>sdk.dir=/Users/hugo/Code/android-sdk-mac\ntarget=Google Inc.:Google APIs:7\nkey.store=certs/rd-release.keystore\nkey.alias=rainydays\nkey.store.password=thisisnotmypassword\nkey.alias.password=thisisnotmypassword</pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>The <em>sdk.dir</em> should point to the Android SDK root on your Hudson node. In my case I&#8217;m running Hudson locally on my machine.  The <em>target</em> property refers to the SDK we want to use as mentioned earlier.  The <em>key.<strong> properties are related to signing of the apk. My <a href=\"https://d.android.com/guide/publishing/app-signing.html#strategies\">strategy</a> is to have a separate key store and private key for each application that I develop. I also check that keystore in to SVN. I also archive the </strong>-release.apk</em> artifact so that I can download the latest release apk directly from Hudson.  After completing these steps, you should be able to build your Android app with Hudson.</p>\n</div>\n<div class=\"paragraph\">\n<p><br></p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_updating_the_androidmanifest_for_release\">Updating the AndroidManifest for release</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>&#8230;&#8203;But we&#8217;re not done yet :) Remember what I said about updating the AndroidManifest.xml? For that we need to edit the build.xml, which by default contains nothing more then a <code>&lt;setup/&gt;</code> tag to pull in the Android SDK ant target definitions. For my Rainy Days application, I adjusted build.xml like this:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre>   ...\n   &lt;setup /&gt;\n   &lt;property environment=\"env\"/&gt;\n   &lt;target name=\"preprocess\" if=\"env.BUILD_TAG\"&gt;\n      &lt;echo&gt;Removing debug attribute from AndroidManifest.xml&lt;/echo&gt;\n      &lt;replaceregexp file=\"AndroidManifest.xml\" match=\"android:debuggable=&amp;quot;.*?&amp;quot;\" replace=\"\"/&gt;\n      &lt;echo&gt;Setting release maps key&lt;/echo&gt;\n      &lt;replaceregexp file=\"res/layout/maplayout.xml\" match=\"android:apiKey=&amp;quot;.*?&amp;quot;\" replace=\"android:apiKey=&amp;quot;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX&amp;quot;\"/&gt;\n   &lt;/target&gt;\n\n   &lt;!-- this target is only hooking release processing of the manifest --&gt;\n   &lt;target name=\"-package-resources\" depends=\"preprocess, android_rules.-package-resources\"&gt;\n   &lt;/target&gt;</pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>What the above snippet does is removing the <em>android:debuggable</em> attribute from the <em>AndroidManifest.xml</em> and replacing the maps API key in <em>res/layout/maplayout.xml</em> with the correct key for release. The <code>-package-resources</code> target is pulled in from the Android <em>android_rules.xml</em> file.</p>\n</div>\n<div class=\"paragraph\">\n<p>Now when Hudson builds my app I get a ready to release apk that I can install on my device or emulator, which is pretty nice.</p>\n</div>\n<div class=\"paragraph\">\n<p>There is are some issues with this approach however. As you might have noticed:</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Replacements are done in the workspace, we are not really building <strong>exactly</strong> what&#8217;s in svn</p>\n</li>\n<li>\n<p>Each new build should start out fresh for that reason, for example by using the svn revert option.</p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>Additionally I can not yet tag the release version with the updated files, because the <a href=\"https://plugins.jenkins.io/subversion-tagging\">subversion tagging plugin</a> doesn&#8217;t support this by design. This could be worked around by adding svn statements in the build.xml however.  For now I don&#8217;t really mind as I make minor changes to the resource files, but I&#8217;ll be looking at improving this situation.</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_things_to_add_unit_testing_coverage\">Things to add: unit testing, coverage&#8230;&#8203;</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>One thing that I&#8217;d really like to add is unit testing. This is a little bit more complicated though, since unit tests require a running emulator and a running emulator requires a gui. The Hudson <a href=\"https://plugins.jenkins.io/xvnc\">Xvnc</a> plugin could be very helpful here.</p>\n</div>\n<div class=\"paragraph\">\n<p>The Android build scripts for test projects already include <a href=\"http://emma.sourceforge.net/\">EMMA</a> output, it shouldn&#8217;t be to hard to use the Hudson <a href=\"https://plugins.jenkins.io/emma\">plugin</a> for that.</p>\n</div>\n<div class=\"paragraph\">\n<p>When Hudson is running on a local machine, the <a href=\"https://plugins.jenkins.io/batch-task\">Batch task</a> plugin can automate installing the apk on a device to automate things further.</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"_summary\">Summary</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>Building Android applications with Hudson is not that hard, since the builds are based on Ant. By hooking in to the standard Android build targets it&#8217;s easy to update files like <em>AndroidManifest.xml</em> which in turn makes sure the release process is controlled and predictable.<br>\nAndroid unit tests depend on the emulator which is a little bit more challenging to set up, but Hudson already has some plugins available to make this easier.</p>\n</div>\n<hr>\n<div class=\"paragraph\">\n<p><strong>Editor&#8217;s Note:</strong> Hugo Visser is the developer of <a href=\"https://code.neenbedankt.com/my-first-published-android-app-rainy-days\">Rainy Days</a> and <a href=\"https://code.neenbedankt.com/monitor-your-app-engine-application-from-your-pocket-with-engine-watch-for-android/\">Engine Watch</a> for Android. You can\nfollow him <a href=\"https://twitter.com/botteaap\">on Twitter</a> and <a href=\"https://code.neenbedankt.com\">on his blog</a>.</p>\n</div>\n</div>\n</div>","document":{"title":"\"Getting started: Building Android apps with Hudson\"","main":"\"Getting started"},"author":{"fullName":"- general"}}},"pageContext":{"id":"d9f0ce55-3bfc-5ccc-805f-5f85713ddebd"}},"staticQueryHashes":[],"slicesMap":{}}